@{
    ViewBag.Title = "BMW Home";
}

<div class="jumbotron">
    <h1>Remote Backup Application</h1>
    <p class="lead"></p>
    <p></p>
</div>

<div class="row">
    <div class="col-md-4">
        <h2>Start Backup</h2>
        <p>
            Source Path of the backup:
        </p> <Input id="sourcePath" type=text value="C:\Users\stefanl\Desktop\SourceFiles" size="130" />

        <p>
            Destination Path of the backup:
        </p> <Input id="targetPath" type=text value="C:\Users\stefanl\Desktop\TargetFiles" size="130"/>

        <p> <input id="btndoBackup" type="button" value="Run Backup."></p>

    </div>

    <div class="col-md-4">
        <h2>Query Log</h2>
        <div id="daGuid">
            <p>Enter an Indentifier to query Backup Logs:</p>
            <p> <Input id="txtQueryGuid" type=text value="" size="130" /></p>
            <p> <input id="btnGiveFeedback" type="button" value="Show Log Detail."></p>
        </div>
    </div>

    <div class="col-md-4">
        <h2>Log Detail</h2>
        <p><div id="daFeedback"></div></p>
    </div>

</div>
@section scripts {
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Proxy Class Location-->
    <script src="~/signalr/hubs"></script>

    <script>
        var simple = $.connection.simpleHub;

        // Client Side function to CLEAR the status of Feebback
        simple.client.clearProgress = function () {

            // alert(progressStatus);
            document.getElementById("daFeedback").innerHTML = "";

        };


        // Client Side function to update the status of Progresss
        simple.client.updateProgress = function (progressStatus) {

            // alert(progressStatus);
            document.getElementById("daFeedback").innerHTML = progressStatus + '</br>' + document.getElementById("daFeedback").innerHTML

        };

        // Client Side Function to update the Guid Field that was generated by the Server.
        simple.client.updateGuid = function (theGuid) {

            alert('Unique Identifier assugned: '+  theGuid);

            document.getElementById("txtQueryGuid").value = theGuid.toString();

        };

        // Client Side Function to alert the User of a problem.
        simple.client.AlertUser = function (theMessage) {

            alert(theMessage);

        };
        


        // Create connection to the hub
        // Upon sucsessfull connection we call the hello function on the Server!
        $.connection.hub.start().done(function () {

            alert('SignalR Connection Established');

           simple.server.hello();

        }
        );

        // On Submitting the Go Button
        // Sever needs to return a GUID-Number for the batch process.
        btndoBackup.onclick = function ()
        {
            //alert('Starting Backup');

            //

            simple.server.doBackup(document.getElementById("sourcePath").value, document.getElementById("targetPath").value); // ASYNC PROCESS - This returns Immediately!
            //alert('Backup Complete');
        }


        // Server Side Function to display Feedback from the logged Database.
        btnGiveFeedback.onclick = function ()
        {

            if (document.getElementById("txtQueryGuid").value =="" ) {

                alert('Please enter an Identifier for the Backup, to view the Log Detail.');
                document.getElementById("txtQueryGuid").focus();

            }
            else {
                // TODO!
                // Add JS Tests here to see if the guid is the right length etc, before submitting for data.
                simple.server.showFeedback(document.getElementById("txtQueryGuid").value);
            }




        }

    </script>

}
